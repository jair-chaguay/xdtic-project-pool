"use strict";function loadProject(){if(!this.noMore){var e=this.urlLoadProject+"?pageNum="+this.pageNum+"&pageSize="+this.pageSize+"&uid="+this.user.id;this.busy=!0,this.isLoading=!0,self=this,fetch(e,{method:"GET",headers:{Accept:"application/json"}}).then(function(e){return e.json()}).then(function(e){self.isLoading=!1,self.projects=0===self.pageNum?e.projects:self.projects.concat(e.projects),e.hasMore===!1&&(self.noMore=!0),self.pageNum++,self.busy=!1})}}var infiniteScroll=require("node_modules/vue-infinite-scroll/vue-infinite-scroll");Vue.use(infiniteScroll);var Promise=require("node_modules/es6-promise/dist/es6-promise").Promise;require("node_modules/whatwg-fetch/fetch");var tools=require("static/js/module/tools"),urlCollect=urlPrefix+"/fn/project/collect",urlUnCollect=urlPrefix+"/fn/project/uncollect",urlLoadProjectMap={post:urlPrefix+"/fn/get/project/myPost",join:urlPrefix+"/fn/get/project/myJoin",collect:urlPrefix+"/fn/get/project/myCollect"},myProjectType=tools.getParams(window.location.href).type,urlLoadProject=urlLoadProjectMap[myProjectType],bus=new Vue;bus.$on("loadProject",function(e){projectBox.pageNum=0,projectBox.myProjectType=e,projectBox.urlLoadProject=urlLoadProjectMap[e],projectBox.projects.splice(0,projectBox.projects.length),projectBox.noMore=!1,projectBox.busy=!1,projectBox.isLoading=!1,projectBox.checkImmediately=!1,projectBox.collectIsFail=!1,projectBox.loadProject()}),Vue.component("tic-project",{template:"#tic-project",props:["project","index","userid","projecttype"],methods:{collect:function(e){this.$emit("collect",e.projectIndex);var t=this,o=urlCollect+"?userid="+e.userid+"&proId="+this.project.proId;fetch(o,{method:"GET",headers:{Accept:"application/json"}}).then(function(e){return e.json()}).then(function(o){"error"===o.code&&(t.$emit("uncollect",e.projectIndex),t.$emit("collectfail"))})},uncollect:function(e){this.$emit("uncollect",e.projectIndex);var t=this,o=urlUnCollect+"?userid="+e.userid+"&proId="+this.project.proId;fetch(o,{method:"GET",headers:{Accept:"application/json"}}).then(function(e){return e.json()}).then(function(o){"error"===o.code&&(t.$emit("collect",e.projectIndex),t.$emit("collectfail"))})}},computed:{projectStatu:function(){return this.project.statu?"pass"===this.project.statu?"审核已通过~":"审核中...":""},projectDetailLink:function(){return"post"===this.projecttype?urlPrefix+"/myProject/myPost/detail":"collect"===this.projecttype?urlPrefix+"/project":"join"===this.projecttype?urlPrefix+"/project":void 0}}});var projectBox=new Vue({el:"#appBody",data:{projects:[],busy:!1,noMore:!1,isLoading:!1,checkImmediately:!1,collectIsFail:!1,pageNum:0,pageSize:5,myProjectType:myProjectType,urlLoadProject:urlLoadProject,user:userInfo},beforeMount:function(){this.loadProject()},methods:{loadProject:loadProject,collect:function(e){this.projects[e].isCollected=!0},uncollect:function(e){this.projects[e].isCollected=!1},closeDialog:function(){this.collectIsFail=!1},openDialog:function(){this.collectIsFail=!0}}}),myProjectNav=new Vue({el:"#myProjectNav",data:{currentLink:myProjectType},methods:{switchType:function(e){var t=e.event,o=t.target;this.currentLink=o.dataset.type,bus.$emit("loadProject",o.dataset.type)}}});